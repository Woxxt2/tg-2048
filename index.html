<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex,nofollow" />
  <title>2048 Color Edition</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #1e1e2f, #2b2d42);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
      padding: 20px;
      color: white;
      overflow: hidden;
    }
    h1 {
      margin: 10px;
      color: #ffcc00;
      font-family: 'Segoe UI', sans-serif;
    }
    #timer, #status {
      margin: 5px;
      font-size: 16px;
      font-weight: bold;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 680px;
      margin-bottom: 10px;
    }
    .game-container {
      position: relative;
      background: #12131a;
      padding: 10px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
      touch-action: none;
    }
    .tile {
      position: absolute;
      font-size: 28px;
      font-weight: bold;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      text-shadow: 1px 1px 2px black;
      transition: top 0.2s ease, left 0.2s ease;
    }
    .tile[data-val="2"] { background-color: #FF6B6B; }
    .tile[data-val="4"] { background-color: #4ECDC4; }
    .tile[data-val="8"] { background-color: #45B7D1; }
    .tile[data-val="16"] { background-color: #FFBE0B; }
    .tile[data-val="32"] { background-color: #FB5607; }
    .tile[data-val="64"] { background-color: #8338EC; }
    .tile[data-val="128"] { background-color: #3A86FF; }
    .tile[data-val="256"] { background-color: #FF006E; }
    .tile[data-val="512"] { background-color: #9B5DE5; }
    .tile[data-val="1024"] { background-color: #00BBF9; }
    .tile[data-val="2048"] { background-color: #00F5D4; font-size: 24px; }
    .tile[data-val="4096"] { background-color: #F15BB5; font-size: 22px; }
    .tile[data-val="8192"] { background-color: #9B5DE5; font-size: 20px; }

    #resetBtn, .mode-btn {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      color: white;
      background-color: #ffcc00;
      cursor: pointer;
      margin: 5px;
    }
    .mode-btn.active {
      background-color: #00F5D4;
      color: #2b2d42;
    }
    .menu {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0,0,0,0.8);
      z-index: 10;
    }
    .menu.hidden {
      display: none;
    }
    .mode-select {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .mode-buttons {
      display: flex;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="menu" id="menu">
    <div class="mode-select">
      <h1>2048 Color Edition</h1>
      <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∏–≥—Ä—ã</h2>
      <div class="mode-buttons">
        <button class="mode-btn active" data-size="4">4√ó4 (–∫–ª–∞—Å—Å–∏–∫–∞)</button>
        <button class="mode-btn" data-size="8">8√ó8 (—ç–∫—Å—Ç—Ä–∏–º)</button>
      </div>
      <button id="startBtn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    </div>
  </div>

  <h1 id="gameTitle">2048</h1>
  <div class="top-bar">
    <div id="timer">Time: 0s</div>
    <div id="status"></div>
  </div>
  <div class="game-container" id="game"></div>
  <button id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É</button>
  <button id="menuBtn">–ú–µ–Ω—é</button>

  <script>
    const container = document.getElementById("game");
    const statusText = document.getElementById("status");
    const timerText = document.getElementById("timer");
    const resetBtn = document.getElementById("resetBtn");
    const menuBtn = document.getElementById("menuBtn");
    const menu = document.getElementById("menu");
    const startBtn = document.getElementById("startBtn");
    const gameTitle = document.getElementById("gameTitle");
    const modeBtns = document.querySelectorAll(".mode-btn");

    let grid, timer, seconds = 0;
    let gridSize = 4;
    let tileSize, tileGap;

    // –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –∏–≥—Ä—ã
    modeBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        modeBtns.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        gridSize = parseInt(btn.dataset.size);
      });
    });

    startBtn.addEventListener("click", () => {
      menu.classList.add("hidden");
      initGame();
    });

    menuBtn.addEventListener("click", () => {
      clearInterval(timer);
      menu.classList.remove("hidden");
    });

    function calculateTileSize() {
      const containerSize = Math.min(680, window.innerWidth - 40);
      const padding = 10;
      const availableSize = containerSize - padding * 2;
      
      if (gridSize === 4) {
        tileGap = 10;
        tileSize = (availableSize - tileGap * (gridSize - 1)) / gridSize;
      } else {
        tileGap = 5;
        tileSize = (availableSize - tileGap * (gridSize - 1)) / gridSize;
      }
      
      container.style.width = `${containerSize}px`;
      container.style.height = `${containerSize}px`;
    }

    function drawTile(value, index) {
      const tile = document.createElement("div");
      tile.className = "tile";
      tile.setAttribute("data-val", value);
      tile.textContent = value;
      const row = Math.floor(index / gridSize);
      const col = index % gridSize;
      tile.style.width = `${tileSize}px`;
      tile.style.height = `${tileSize}px`;
      tile.style.left = `${col * (tileSize + tileGap)}px`;
      tile.style.top = `${row * (tileSize + tileGap)}px`;
      
      // –£–º–µ–Ω—å—à–∞–µ–º —à—Ä–∏—Ñ—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª
      if (value >= 2048) {
        tile.style.fontSize = `${28 - Math.floor(Math.log2(value) - 10)}px`;
      }
      
      return tile;
    }

    function drawGrid() {
      container.innerHTML = "";
      grid.forEach((val, i) => {
        if (val !== 0) container.appendChild(drawTile(val, i));
      });
    }

    function initGame() {
      calculateTileSize();
      grid = Array.from({ length: gridSize * gridSize }, () => 0);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø–ª–∏—Ç–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Å–µ—Ç–∫–∏
      const initialTiles = gridSize === 4 ? 2 : 4;
      for (let i = 0; i < initialTiles; i++) {
        addRandomTile();
      }
      
      drawGrid();
      statusText.textContent = "";
      gameTitle.textContent = `2048 (${gridSize}√ó${gridSize})`;
      seconds = 0;
      clearInterval(timer);
      timer = setInterval(() => {
        seconds++;
        timerText.textContent = `Time: ${seconds}s`;
      }, 1000);
    }

    function addRandomTile() {
      const empty = grid.map((v, i) => v === 0 ? i : null).filter(v => v !== null);
      if (empty.length === 0) return;
      const randIndex = empty[Math.floor(Math.random() * empty.length)];
      grid[randIndex] = Math.random() < 0.9 ? 2 : 4;
    }

    function checkGameState() {
      const target = gridSize === 4 ? 2048 : 8192;
      if (grid.includes(target)) {
        statusText.textContent = "üéâ –ü–æ–±–µ–¥–∞!";
        clearInterval(timer);
      } else if (!grid.includes(0)) {
        statusText.textContent = "üò¢ –ò–≥—Ä–∞ –ø—Ä–æ–∏–≥—Ä–∞–Ω–∞";
        clearInterval(timer);
      }
    }

    function move(direction) {
      const newGrid = Array.from(grid);
      let moved = false;

      function getIndex(row, col) {
        row = (row + gridSize) % gridSize;
        col = (col + gridSize) % gridSize;
        return row * gridSize + col;
      }

      for (let i = 0; i < gridSize; i++) {
        let line = [];
        for (let j = 0; j < gridSize; j++) {
          let val;
          switch (direction) {
            case "left": val = newGrid[getIndex(i, j)]; break;
            case "right": val = newGrid[getIndex(i, gridSize - 1 - j)]; break;
            case "up": val = newGrid[getIndex(j, i)]; break;
            case "down": val = newGrid[getIndex(gridSize - 1 - j, i)]; break;
          }
          if (val !== 0) line.push(val);
        }
        
        // –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–ª–∏—Ç–æ–∫
        for (let k = 0; k < line.length - 1; k++) {
          if (line[k] === line[k + 1]) {
            line[k] *= 2;
            line[k + 1] = 0;
            moved = true;
          }
        }
        
        line = line.filter(v => v !== 0);
        while (line.length < gridSize) line.push(0);

        for (let j = 0; j < gridSize; j++) {
          let index;
          switch (direction) {
            case "left": index = getIndex(i, j); break;
            case "right": index = getIndex(i, gridSize - 1 - j); break;
            case "up": index = getIndex(j, i); break;
            case "down": index = getIndex(gridSize - 1 - j, i); break;
          }
          if (newGrid[index] !== line[j]) moved = true;
          newGrid[index] = line[j];
        }
      }

      if (moved) {
        grid = newGrid;
        addRandomTile();
        drawGrid();
        checkGameState();
      }
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
    document.addEventListener("keydown", e => {
      const dir = {
        ArrowUp: "up",
        ArrowDown: "down",
        ArrowLeft: "left",
        ArrowRight: "right"
      }[e.key];
      if (dir) {
        e.preventDefault();
        move(dir);
      }
    });

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å–∞–Ω–∏—è–º–∏
    let touchStartX = 0, touchStartY = 0;
    container.addEventListener("touchstart", e => {
      const touch = e.touches[0];
      touchStartX = touch.clientX;
      touchStartY = touch.clientY;
      e.preventDefault();
    }, { passive: false });

    container.addEventListener("touchmove", e => {
      e.preventDefault();
    }, { passive: false });

    container.addEventListener("touchend", e => {
      const touch = e.changedTouches[0];
      const dx = touch.clientX - touchStartX;
      const dy = touch.clientY - touchStartY;
      
      if (Math.abs(dx) > Math.abs(dy)) {
        if (dx > 20) move("right");
        else if (dx < -20) move("left");
      } else {
        if (dy > 20) move("down");
        else if (dy < -20) move("up");
      }
      e.preventDefault();
    }, { passive: false });

    resetBtn.addEventListener("click", initGame);

    // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
    window.addEventListener("resize", () => {
      if (!menu.classList.contains("hidden")) return;
      calculateTileSize();
      drawGrid();
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω—é
    menu.classList.remove("hidden");
  </script>
</body>
</html>
